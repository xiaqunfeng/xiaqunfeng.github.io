<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ceph placement group | 夏天的风的博客</title>
  <meta name="keywords" content=" ceph ">
  <meta name="description" content="ceph placement group | 夏天的风的博客">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="关注人工智能、深度学习、分布式存储（FusionStorage, Ceph, …）、云计算

最近主要focus在人工智能上，关于之前分布式存储的笔记会陆续整理发布上来


本博客为个人学习总结随笔，所有文章非特殊标注皆为原创，转载请务必注明出处！

联系方式email：xiaqunfeng123@126.com

打赏通道如果该碰巧文章对您有所帮助，感谢小额鼓励。 谢谢O(∩_∩)O~">
<meta property="og:type" content="website">
<meta property="og:title" content="关于我">
<meta property="og:url" content="http://xiaqunfeng.cc/about/index.html">
<meta property="og:site_name" content="夏天的风的博客">
<meta property="og:description" content="关注人工智能、深度学习、分布式存储（FusionStorage, Ceph, …）、云计算

最近主要focus在人工智能上，关于之前分布式存储的笔记会陆续整理发布上来


本博客为个人学习总结随笔，所有文章非特殊标注皆为原创，转载请务必注明出处！

联系方式email：xiaqunfeng123@126.com

打赏通道如果该碰巧文章对您有所帮助，感谢小额鼓励。 谢谢O(∩_∩)O~">
<meta property="og:image" content="http://ojet8bprn.bkt.clouddn.com/%E6%89%93%E8%B5%8F1.jpg">
<meta property="og:updated_time" content="2018-03-04T12:32:04.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="关于我">
<meta name="twitter:description" content="关注人工智能、深度学习、分布式存储（FusionStorage, Ceph, …）、云计算

最近主要focus在人工智能上，关于之前分布式存储的笔记会陆续整理发布上来


本博客为个人学习总结随笔，所有文章非特殊标注皆为原创，转载请务必注明出处！

联系方式email：xiaqunfeng123@126.com

打赏通道如果该碰巧文章对您有所帮助，感谢小额鼓励。 谢谢O(∩_∩)O~">
<meta name="twitter:image" content="http://ojet8bprn.bkt.clouddn.com/%E6%89%93%E8%B5%8F1.jpg">


<link rel="icon" href="/img/apple2.ico">

<link rel="stylesheet" href="/css/style.css">

<link rel="stylesheet" href="/css/hl_theme/school-book.css">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<link href="//cdn.bootcss.com/photoswipe/4.1.2/photoswipe.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/photoswipe/4.1.2/default-skin/default-skin.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="true">
</div>
<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/stark.jpg" />
</a>
<div class="author">
    <span>夏天的风</span>
</div>

<div class="icon">
    
    
    <a class="github" title="github" href="https://github.com/xiaqunfeng" target="_blank"></a>
    
    
    
    
    
    
    
    
    <a class="email" title="email" href="mailto:xiaqunfeng123@126.com"></a>
    
</div>



<ul>
    <li class="all active">全部文章</li>
    
    <li data-rel="DeepLearning"> DeepLearning </li>
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a style="border-right: 1px solid #fff; width: 49%"  class="about site_url"  href="/about">关于</a><a style="width: 50%"  class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="90">
<input type="hidden" id="yelog_site_word_count" value="114.5k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>
    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://blog.csdn.net/xiaqunfeng123">夏天的风CSDN</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode==13){return false;}">
        <input class="search" type="text" placeholder="Search..." autocomplete="off"id="local-search-input" >
        <i class="cross"></i>
        <span>
        <label for="tagswitch">Tags:</label>
        <input id="tagswitch" type="checkbox">
    </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">ceph</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">storage</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">paper</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">deeplearning</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">Linux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">shell</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">machine learning</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">rocksdb</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">centos</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">ubuntu</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">code</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">git</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">mac</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">caffe</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">python</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">ganesha</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">cloud</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">network</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a  class=""
           href="/2017/02/23/Bluestore调研/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="Bluestore调研">Bluestore调研</span>
            <span class="post-date" title="2017-02-23 16:30:39">2017/02/23</span>
        </a>
        
        <a  class=""
           href="/2017/01/24/Ceph-KRAKEN(V11.2.0)/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="Ceph — V11.2.0 KRAKEN(译)">Ceph — V11.2.0 KRAKEN(译)</span>
            <span class="post-date" title="2017-01-24 17:48:51">2017/01/24</span>
        </a>
        
        <a  class=""
           href="/2017/06/28/Ceph-v12-1-0-Luminous-RC-released/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="Ceph v12.1.0 Luminous RC released">Ceph v12.1.0 Luminous RC released</span>
            <span class="post-date" title="2017-06-28 11:44:27">2017/06/28</span>
        </a>
        
        <a  class=""
           href="/2017/01/20/Ceph中严重数据不一致性BUG/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="Ceph中严重数据不一致性BUG">Ceph中严重数据不一致性BUG</span>
            <span class="post-date" title="2017-01-20 15:15:20">2017/01/20</span>
        </a>
        
        <a  class=""
           href="/2017/02/03/Dm-cache-vs-Bcache/"
           data-tag="storage"
           data-author="" >
            <span class="post-title" title="Dm-cache vs Bcache">Dm-cache vs Bcache</span>
            <span class="post-date" title="2017-02-03 17:37:45">2017/02/03</span>
        </a>
        
        <a  class=""
           href="/2017/01/24/Crushmap学习/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="Crushmap学习">Crushmap学习</span>
            <span class="post-date" title="2017-01-24 13:48:49">2017/01/24</span>
        </a>
        
        <a  class=""
           href="/2017/11/25/Fast-R-CNN/"
           data-tag="paper,deeplearning"
           data-author="" >
            <span class="post-title" title="【论文阅读】Fast R-CNN">【论文阅读】Fast R-CNN</span>
            <span class="post-date" title="2017-11-25 11:44:13">2017/11/25</span>
        </a>
        
        <a  class=""
           href="/2017/12/14/Faster-R-CNN/"
           data-tag="paper,deeplearning"
           data-author="" >
            <span class="post-title" title="【论文阅读】Faster-R-CNN">【论文阅读】Faster-R-CNN</span>
            <span class="post-date" title="2017-12-14 13:08:34">2017/12/14</span>
        </a>
        
        <a  class=""
           href="/2017/02/03/Flashcache-vs-Cache-tier/"
           data-tag="storage"
           data-author="" >
            <span class="post-title" title="Flashcache vs Cache tier">Flashcache vs Cache tier</span>
            <span class="post-date" title="2017-02-03 17:15:15">2017/02/03</span>
        </a>
        
        <a  class=""
           href="/2017/01/11/Linux下利用screen进行屏幕协作/"
           data-tag="Linux,shell"
           data-author="" >
            <span class="post-title" title="Linux下利用screen进行屏幕协作">Linux下利用screen进行屏幕协作</span>
            <span class="post-date" title="2017-01-11 11:30:52">2017/01/11</span>
        </a>
        
        <a  class=""
           href="/2017/01/11/Linux命令——crontab/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="Linux命令——crontab">Linux命令——crontab</span>
            <span class="post-date" title="2017-01-11 10:10:04">2017/01/11</span>
        </a>
        
        <a  class=""
           href="/2017/01/11/Linux命令——history及其优化/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="Linux命令——history及其优化">Linux命令——history及其优化</span>
            <span class="post-date" title="2017-01-11 14:01:13">2017/01/11</span>
        </a>
        
        <a  class=""
           href="/2017/01/25/Linux命令——parted/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="Linux命令——parted">Linux命令——parted</span>
            <span class="post-date" title="2017-01-25 17:59:39">2017/01/25</span>
        </a>
        
        <a  class=""
           href="/2017/02/17/Linux命令——pgrep和pkill/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="Linux命令——pgrep和pkill">Linux命令——pgrep和pkill</span>
            <span class="post-date" title="2017-02-17 10:25:05">2017/02/17</span>
        </a>
        
        <a  class=""
           href="/2017/02/16/Linux命令——strace/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="Linux命令——strace">Linux命令——strace</span>
            <span class="post-date" title="2017-02-16 19:35:52">2017/02/16</span>
        </a>
        
        <a  class=""
           href="/2017/01/17/Linux命令——uptime/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="Linux命令——uptime">Linux命令——uptime</span>
            <span class="post-date" title="2017-01-17 18:05:16">2017/01/17</span>
        </a>
        
        <a  class=""
           href="/2018/03/18/Mac-Tensorflow-Keras/"
           data-tag="deeplearning"
           data-author="" >
            <span class="post-title" title="Mac-Tensorflow-Keras">Mac-Tensorflow-Keras</span>
            <span class="post-date" title="2018-03-18 10:30:48">2018/03/18</span>
        </a>
        
        <a  class=""
           href="/2017/03/03/Machine-Learning-Yearning-3、4/"
           data-tag="machine learning"
           data-author="" >
            <span class="post-title" title="Machine Learning Yearning(3、4)">Machine Learning Yearning(3、4)</span>
            <span class="post-date" title="2017-03-03 09:14:50">2017/03/03</span>
        </a>
        
        <a  class=""
           href="/2017/03/09/Machine-Learning-Yearning-5、6/"
           data-tag="machine learning"
           data-author="" >
            <span class="post-title" title="Machine Learning Yearning(5、6、7)">Machine Learning Yearning(5、6、7)</span>
            <span class="post-date" title="2017-03-09 10:38:35">2017/03/09</span>
        </a>
        
        <a  class=""
           href="/2017/03/02/Machine-Learning-Yearning-开篇、1、2/"
           data-tag="machine learning"
           data-author="" >
            <span class="post-title" title="Machine Learning Yearning(开篇、1、2)">Machine Learning Yearning(开篇、1、2)</span>
            <span class="post-date" title="2017-03-02 10:00:29">2017/03/02</span>
        </a>
        
        <a  class=""
           href="/2017/06/07/Map-RBD-Devices-on-NBD/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="Map RBD Devices on NBD">Map RBD Devices on NBD</span>
            <span class="post-date" title="2017-06-07 10:51:42">2017/06/07</span>
        </a>
        
        <a  class=""
           href="/2017/11/24/R-CNN/"
           data-tag="paper,deeplearning"
           data-author="" >
            <span class="post-title" title="【论文阅读】R-CNN">【论文阅读】R-CNN</span>
            <span class="post-date" title="2017-11-24 20:08:43">2017/11/24</span>
        </a>
        
        <a  class=""
           href="/2017/02/23/RocksDB相比LevelDB的新特性/"
           data-tag="rocksdb"
           data-author="" >
            <span class="post-title" title="RocksDB相比LevelDB的新特性">RocksDB相比LevelDB的新特性</span>
            <span class="post-date" title="2017-02-23 11:22:32">2017/02/23</span>
        </a>
        
        <a  class=""
           href="/2017/07/28/Remove-Big-RBD-Image/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="Remove Big RBD Image">Remove Big RBD Image</span>
            <span class="post-date" title="2017-07-28 09:50:45">2017/07/28</span>
        </a>
        
        <a  class=""
           href="/2017/02/10/RBD-相关操作/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="RBD 相关操作">RBD 相关操作</span>
            <span class="post-date" title="2017-02-10 15:47:18">2017/02/10</span>
        </a>
        
        <a  class=""
           href="/2017/05/07/S-M-A-R-T-磁盘健康状态监测工具/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="S.M.A.R.T--磁盘健康状态监测工具">S.M.A.R.T--磁盘健康状态监测工具</span>
            <span class="post-date" title="2017-05-07 15:25:21">2017/05/07</span>
        </a>
        
        <a  class=""
           href="/2017/08/29/Syntax-error-unexpected/"
           data-tag="shell"
           data-author="" >
            <span class="post-title" title="Syntax error: &#39;(&#39; unexpected">Syntax error: &#39;(&#39; unexpected</span>
            <span class="post-date" title="2017-08-29 19:31:11">2017/08/29</span>
        </a>
        
        <a  class=""
           href="/2017/05/26/GPG-key-retrieval-failure/"
           data-tag="centos"
           data-author="" >
            <span class="post-title" title="GPG key retrieval failure">GPG key retrieval failure</span>
            <span class="post-date" title="2017-05-26 09:13:24">2017/05/26</span>
        </a>
        
        <a  class=""
           href="/2017/02/20/Kernel modules (简体中文)/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="Kernel modules (简体中文)">Kernel modules (简体中文)</span>
            <span class="post-date" title="2017-02-20 10:35:00">2017/02/20</span>
        </a>
        
        <a  class=""
           href="/2017/05/02/VSM部署/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="VSM部署">VSM部署</span>
            <span class="post-date" title="2017-05-02 14:16:59">2017/05/02</span>
        </a>
        
        <a  class=""
           href="/2017/07/06/XFS-vs-EXT4/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="XFS vs EXT4">XFS vs EXT4</span>
            <span class="post-date" title="2017-07-06 16:55:54">2017/07/06</span>
        </a>
        
        <a  class=""
           href="/2017/09/19/awk-study-notes/"
           data-tag="shell"
           data-author="" >
            <span class="post-title" title="awk study notes">awk study notes</span>
            <span class="post-date" title="2017-09-19 15:34:15">2017/09/19</span>
        </a>
        
        <a  class=""
           href="/2017/06/16/centos-7下操纵ceph进程/"
           data-tag="ceph,centos"
           data-author="" >
            <span class="post-title" title="centos 7下操纵ceph进程">centos 7下操纵ceph进程</span>
            <span class="post-date" title="2017-06-16 10:57:50">2017/06/16</span>
        </a>
        
        <a  class=""
           href="/2017/07/07/centos7上安装python3/"
           data-tag="centos"
           data-author="" >
            <span class="post-title" title="centos7上安装python3">centos7上安装python3</span>
            <span class="post-date" title="2017-07-07 16:55:34">2017/07/07</span>
        </a>
        
        <a  class=""
           href="/2017/07/17/centos下ceph部署/"
           data-tag="ceph,centos"
           data-author="" >
            <span class="post-title" title="centos下ceph部署">centos下ceph部署</span>
            <span class="post-date" title="2017-07-17 18:27:42">2017/07/17</span>
        </a>
        
        <a  class=""
           href="/2017/06/29/ceph-Luminous初探/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph Luminous dashboard初探">ceph Luminous dashboard初探</span>
            <span class="post-date" title="2017-06-29 15:45:15">2017/06/29</span>
        </a>
        
        <a  class=""
           href="/2017/07/04/ceph-Luminous新功能之crush-class/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph Luminous新功能之crush class">ceph Luminous新功能之crush class</span>
            <span class="post-date" title="2017-07-04 11:07:57">2017/07/04</span>
        </a>
        
        <a  class=""
           href="/2017/09/18/ceph-PGs-per-Pool-Calculator/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph PGs per Pool Calculator">ceph PGs per Pool Calculator</span>
            <span class="post-date" title="2017-09-18 10:07:45">2017/09/18</span>
        </a>
        
        <a  class=""
           href="/2018/02/28/ceph-ansible使用手册/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph ansible使用手册">ceph ansible使用手册</span>
            <span class="post-date" title="2018-02-28 19:59:56">2018/02/28</span>
        </a>
        
        <a  class=""
           href="/2018/02/28/ceph-iscsi网关/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph iscsi网关">ceph iscsi网关</span>
            <span class="post-date" title="2018-02-28 20:06:46">2018/02/28</span>
        </a>
        
        <a  class=""
           href="/2017/07/06/ceph-luminous新命令探索/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph luminous新命令探索">ceph luminous新命令探索</span>
            <span class="post-date" title="2017-07-06 14:27:33">2017/07/06</span>
        </a>
        
        <a  class=""
           href="/2018/03/04/ceph-luminous最佳部署实践/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph luminous最佳部署实践">ceph luminous最佳部署实践</span>
            <span class="post-date" title="2018-03-04 20:17:03">2018/03/04</span>
        </a>
        
        <a  class=""
           href="/2017/05/26/ceph-mon时钟偏移问题/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph mon时钟偏移问题">ceph mon时钟偏移问题</span>
            <span class="post-date" title="2017-05-26 09:47:05">2017/05/26</span>
        </a>
        
        <a  class=""
           href="/2017/08/17/ceph-osd相关操作/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph osd相关操作">ceph osd相关操作</span>
            <span class="post-date" title="2017-08-17 16:07:13">2017/08/17</span>
        </a>
        
        <a  class=""
           href="/2018/03/08/ceph-osd权重调整/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph osd权重调整">ceph osd权重调整</span>
            <span class="post-date" title="2018-03-08 20:22:36">2018/03/08</span>
        </a>
        
        <a  class=""
           href="/2017/08/01/ceph-peering过程分析/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph peering过程分析">ceph peering过程分析</span>
            <span class="post-date" title="2017-08-01 16:47:05">2017/08/01</span>
        </a>
        
        <a  class=""
           href="/2017/07/28/ceph-placement-group/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph placement group">ceph placement group</span>
            <span class="post-date" title="2017-07-28 15:20:25">2017/07/28</span>
        </a>
        
        <a  class=""
           href="/2017/06/06/ceph-rbd-map-failed/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph rbd map failed">ceph rbd map failed</span>
            <span class="post-date" title="2017-06-06 11:29:17">2017/06/06</span>
        </a>
        
        <a  class=""
           href="/2017/11/18/ceph写流程分析/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph写流程分析">ceph写流程分析</span>
            <span class="post-date" title="2017-11-18 17:41:38">2017/11/18</span>
        </a>
        
        <a  class=""
           href="/2017/02/04/ceph升级到kraken版本/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph升级到kraken版本">ceph升级到kraken版本</span>
            <span class="post-date" title="2017-02-04 19:06:40">2017/02/04</span>
        </a>
        
        <a  class=""
           href="/2017/05/23/ceph日志迁移/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph日志迁移">ceph日志迁移</span>
            <span class="post-date" title="2017-05-23 17:20:48">2017/05/23</span>
        </a>
        
        <a  class=""
           href="/2017/09/27/ceph指定版本安装/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="ceph指定版本安装">ceph指定版本安装</span>
            <span class="post-date" title="2017-09-27 10:39:21">2017/09/27</span>
        </a>
        
        <a  class=""
           href="/2017/07/17/ceph部署完全手册/"
           data-tag="ceph,ubuntu"
           data-author="" >
            <span class="post-title" title="ceph部署完全手册">ceph部署完全手册</span>
            <span class="post-date" title="2017-07-17 16:46:33">2017/07/17</span>
        </a>
        
        <a  class=""
           href="/2017/03/09/cow和row快照机制的区别/"
           data-tag="storage"
           data-author="" >
            <span class="post-title" title="cow和row快照机制的区别">cow和row快照机制的区别</span>
            <span class="post-date" title="2017-03-09 11:32:24">2017/03/09</span>
        </a>
        
        <a  class=""
           href="/2017/05/11/cpu拓扑结构/"
           data-tag="ceph,Linux"
           data-author="" >
            <span class="post-title" title="cpu拓扑及ceph使用时的优化">cpu拓扑及ceph使用时的优化</span>
            <span class="post-date" title="2017-05-11 09:23:18">2017/05/11</span>
        </a>
        
        <a  class=""
           href="/2017/01/12/dd磁盘命令小记/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="dd磁盘命令小记">dd磁盘命令小记</span>
            <span class="post-date" title="2017-01-12 20:30:49">2017/01/12</span>
        </a>
        
        <a  class=""
           href="/2017/12/05/faster-r-cnn-generate-anchors/"
           data-tag="code"
           data-author="" >
            <span class="post-title" title="【代码阅读】generate_anchors.py">【代码阅读】generate_anchors.py</span>
            <span class="post-date" title="2017-12-05 09:42:49">2017/12/05</span>
        </a>
        
        <a  class=""
           href="/2017/05/07/firewalld和iptables/"
           data-tag="Linux,centos"
           data-author="" >
            <span class="post-title" title="firewalld和iptables">firewalld和iptables</span>
            <span class="post-date" title="2017-05-07 16:08:01">2017/05/07</span>
        </a>
        
        <a  class=""
           href="/2017/07/12/fio测试ceph/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="fio测试ceph">fio测试ceph</span>
            <span class="post-date" title="2017-07-12 11:17:04">2017/07/12</span>
        </a>
        
        <a  class=""
           href="/2017/08/07/git常用命名总结/"
           data-tag="git"
           data-author="" >
            <span class="post-title" title="git常用命名总结">git常用命名总结</span>
            <span class="post-date" title="2017-08-07 17:24:32">2017/08/07</span>
        </a>
        
        <a  class=""
           href="/2017/01/06/hexo的搭建/"
           data-tag="mac"
           data-author="" >
            <span class="post-title" title="Mac上hexo博客的搭建">Mac上hexo博客的搭建</span>
            <span class="post-date" title="2017-01-06 15:47:18">2017/01/06</span>
        </a>
        
        <a  class=""
           href="/2017/05/02/iterm2快捷键的使用/"
           data-tag="mac"
           data-author="" >
            <span class="post-title" title="iterm2快捷键的使用">iterm2快捷键的使用</span>
            <span class="post-date" title="2017-05-02 20:46:35">2017/05/02</span>
        </a>
        
        <a  class=""
           href="/2018/03/11/inkscope安装配置/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="inkscope安装配置">inkscope安装配置</span>
            <span class="post-date" title="2018-03-11 20:49:42">2018/03/11</span>
        </a>
        
        <a  class=""
           href="/2017/05/04/iterm2配色/"
           data-tag="mac"
           data-author="" >
            <span class="post-title" title="iterm2配色--zsh &amp; oh-my-zsh">iterm2配色--zsh &amp; oh-my-zsh</span>
            <span class="post-date" title="2017-05-04 20:32:26">2017/05/04</span>
        </a>
        
        <a  class=""
           href="/2017/09/21/linux-command-day-day-up/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="linux command day day up">linux command day day up</span>
            <span class="post-date" title="2017-09-21 20:41:47">2017/09/21</span>
        </a>
        
        <a  class=""
           href="/2018/03/13/mac上Matplotlib中文乱码问题/"
           data-tag="mac"
           data-author="" >
            <span class="post-title" title="mac上Matplotlib中文乱码问题">mac上Matplotlib中文乱码问题</span>
            <span class="post-date" title="2018-03-13 09:29:33">2018/03/13</span>
        </a>
        
        <a  class=""
           href="/2017/08/30/lsblk命令/"
           data-tag="storage"
           data-author="" >
            <span class="post-title" title="lsblk命令">lsblk命令</span>
            <span class="post-date" title="2017-08-30 14:36:20">2017/08/30</span>
        </a>
        
        <a  class=""
           href="/2017/09/11/mac上安装python3/"
           data-tag="mac"
           data-author="" >
            <span class="post-title" title="mac上安装python3">mac上安装python3</span>
            <span class="post-date" title="2017-09-11 15:35:30">2017/09/11</span>
        </a>
        
        <a  class=""
           href="/2017/11/05/mac上安装caffe并训练mnist/"
           data-tag="caffe"
           data-author="" >
            <span class="post-title" title="mac上安装caffe并训练mnist">mac上安装caffe并训练mnist</span>
            <span class="post-date" title="2017-11-05 19:57:53">2017/11/05</span>
        </a>
        
        <a  class=""
           href="/2017/05/25/mac上实现vim的markdown预览/"
           data-tag="mac"
           data-author="" >
            <span class="post-title" title="mac上实现vim的markdown预览">mac上实现vim的markdown预览</span>
            <span class="post-date" title="2017-05-25 10:11:55">2017/05/25</span>
        </a>
        
        <a  class="DeepLearning "
           href="/2018/03/21/mtcnn-note/"
           data-tag="paper"
           data-author="" >
            <span class="post-title" title="【论文阅读】mtcnn">【论文阅读】mtcnn</span>
            <span class="post-date" title="2018-03-21 16:32:06">2018/03/21</span>
        </a>
        
        <a  class=""
           href="/2017/08/05/python3-OS-module/"
           data-tag="python"
           data-author="" >
            <span class="post-title" title="python3 OS module">python3 OS module</span>
            <span class="post-date" title="2017-08-05 10:36:11">2017/08/05</span>
        </a>
        
        <a  class=""
           href="/2017/05/03/nginx使用和配置/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="nginx使用和配置">nginx使用和配置</span>
            <span class="post-date" title="2017-05-03 08:17:44">2017/05/03</span>
        </a>
        
        <a  class=""
           href="/2017/09/15/too-many-PGs-per-OSD/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="too many PGs per OSD">too many PGs per OSD</span>
            <span class="post-date" title="2017-09-15 06:48:04">2017/09/15</span>
        </a>
        
        <a  class=""
           href="/2017/01/11/ubuntu下配置邮件发送/"
           data-tag="Linux,ubuntu"
           data-author="" >
            <span class="post-title" title="ubuntu下配置邮件发送">ubuntu下配置邮件发送</span>
            <span class="post-date" title="2017-01-11 14:11:24">2017/01/11</span>
        </a>
        
        <a  class=""
           href="/2017/01/11/ubuntu下系统打包/"
           data-tag="Linux,ubuntu"
           data-author="" >
            <span class="post-title" title="ubuntu下系统打包">ubuntu下系统打包</span>
            <span class="post-date" title="2017-01-11 14:09:42">2017/01/11</span>
        </a>
        
        <a  class=""
           href="/2017/06/15/vim移动光标/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="vim移动光标">vim移动光标</span>
            <span class="post-date" title="2017-06-15 19:17:41">2017/06/15</span>
        </a>
        
        <a  class=""
           href="/2017/08/03/为什么对于企业NAS来说NFS-ganesha是一个更好的NFS-server/"
           data-tag="ganesha"
           data-author="" >
            <span class="post-title" title="为什么对于企业NAS来说NFS-ganesha是一个更好的NFS server">为什么对于企业NAS来说NFS-ganesha是一个更好的NFS server</span>
            <span class="post-date" title="2017-08-03 19:57:19">2017/08/03</span>
        </a>
        
        <a  class=""
           href="/2017/06/23/wget批量下载http目录及文件/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="wget批量下载http目录及文件">wget批量下载http目录及文件</span>
            <span class="post-date" title="2017-06-23 18:21:12">2017/06/23</span>
        </a>
        
        <a  class=""
           href="/2017/06/16/公有云和私有云的区别/"
           data-tag="cloud"
           data-author="" >
            <span class="post-title" title="公有云和私有云的区别">公有云和私有云的区别</span>
            <span class="post-date" title="2017-06-16 14:38:40">2017/06/16</span>
        </a>
        
        <a  class=""
           href="/2017/02/07/在Kraken-release版本上测试Ceph-BlueStore/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="在Kraken release版本上测试Ceph BlueStore">在Kraken release版本上测试Ceph BlueStore</span>
            <span class="post-date" title="2017-02-07 11:13:16">2017/02/07</span>
        </a>
        
        <a  class=""
           href="/2018/03/08/客户端rbd环境检查/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="客户端rbd环境检查">客户端rbd环境检查</span>
            <span class="post-date" title="2018-03-08 20:47:49">2018/03/08</span>
        </a>
        
        <a  class=""
           href="/2017/03/24/常用git命令清单/"
           data-tag="git"
           data-author="" >
            <span class="post-title" title="常用git命令清单">常用git命令清单</span>
            <span class="post-date" title="2017-03-24 18:37:02">2017/03/24</span>
        </a>
        
        <a  class=""
           href="/2017/01/20/块存储的世界/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="块存储的世界">块存储的世界</span>
            <span class="post-date" title="2017-01-20 15:03:33">2017/01/20</span>
        </a>
        
        <a  class=""
           href="/2017/03/01/异步IO/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="异步IO">异步IO</span>
            <span class="post-date" title="2017-03-01 14:03:07">2017/03/01</span>
        </a>
        
        <a  class=""
           href="/2017/02/04/用户态和内核态/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="用户态和内核态">用户态和内核态</span>
            <span class="post-date" title="2017-02-04 20:09:58">2017/02/04</span>
        </a>
        
        <a  class=""
           href="/2017/03/24/理解socket编程/"
           data-tag="Linux,network"
           data-author="" >
            <span class="post-title" title="理解socket编程">理解socket编程</span>
            <span class="post-date" title="2017-03-24 10:27:49">2017/03/24</span>
        </a>
        
        <a  class=""
           href="/2017/02/10/获取每个osd的PG数/"
           data-tag="ceph,shell"
           data-author="" >
            <span class="post-title" title="获取每个osd的PG数">获取每个osd的PG数</span>
            <span class="post-date" title="2017-02-10 20:14:20">2017/02/10</span>
        </a>
        
        <a  class=""
           href="/2017/01/12/解决calamari无法获取集群hosts信息的BUG/"
           data-tag="ceph"
           data-author="" >
            <span class="post-title" title="解决calamari无法获取集群hosts信息的BUG">解决calamari无法获取集群hosts信息的BUG</span>
            <span class="post-date" title="2017-01-12 17:55:14">2017/01/12</span>
        </a>
        
        <a  class=""
           href="/2017/01/25/认识SSD/"
           data-tag="storage"
           data-author="" >
            <span class="post-title" title="认识SSD">认识SSD</span>
            <span class="post-date" title="2017-01-25 11:02:44">2017/01/25</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-ceph-placement-group" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">ceph placement group</h1>
    
    <div class="article-meta">
        
        
        
        
        <span class="tag">
            
            <a href="javascript:" class="color5">ceph</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2017-07-28 15:47:52'>2017-07-28 15:20</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:3,569</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#PG命名"><span class="toc-text">PG命名</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PG唯一标识符"><span class="toc-text">PG唯一标识符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看osd目录里pg"><span class="toc-text">查看osd目录里pg</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PG状态"><span class="toc-text">PG状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取PG列表"><span class="toc-text">获取PG列表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#写一个object"><span class="toc-text">写一个object</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PG状态变化"><span class="toc-text">PG状态变化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PG修复"><span class="toc-text">PG修复</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PG状态列表"><span class="toc-text">PG状态列表</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-4 i,
    .toc-level-4 ol {
        display: none !important;
    }
</style>
</div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>从PG的命名开始介绍，利用一个对象详细演练PG各个状态的变化，并介绍PG状态列表及意义。<br><a id="more"></a></p>
<h2 id="PG命名"><a href="#PG命名" class="headerlink" title="PG命名"></a>PG命名</h2><h3 id="PG唯一标识符"><a href="#PG唯一标识符" class="headerlink" title="PG唯一标识符"></a>PG唯一标识符</h3><p>归置组 ID 包含存储池号（不是存储池名字），后面跟一个点（ . ），然后是归置组 ID，一个十六进制数字。用 <code>ceph osd lspools</code> 可查看存储池号及其名字，默认存储池rbd 对应的存储池号是 0  。完整的归置组 ID 格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;pool-num&#125;.&#123;pg-id&#125;</div></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">0.1f</div></pre></td></tr></table></figure>
<p>系统默认生成的<code>rbd</code>池的id号为<code>0</code>，所以 rbd 池内的所有PG都会以<code>0.</code>开头。</p>
<h3 id="查看osd目录里pg"><a href="#查看osd目录里pg" class="headerlink" title="查看osd目录里pg"></a>查看osd目录里pg</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># ls /var/lib/ceph/osd/ceph-0/</div><div class="line">activate.monmap  ceph_fsid        fsid             journal_uuid     magic            store_version    systemd          whoami</div><div class="line">active           current/         journal          keyring          ready            superblock       type</div></pre></td></tr></table></figure>
<p><code>osd.0</code>下<code>current</code>目录的内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ls /var/lib/ceph/osd/ceph-0/current/</div><div class="line">0.0_head   0.1d_head  0.34_head  0.45_head  0.4e_head</div></pre></td></tr></table></figure>
<p>每个OSD的<code>current</code>目录下都保存了部分的PG，而rbd池的PG以<code>0.xxx_head</code>的目录形式存在！</p>
<h2 id="PG状态"><a href="#PG状态" class="headerlink" title="PG状态"></a>PG状态</h2><p>查看所有归置组状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph pg stat</div><div class="line">v614916: 128 pgs: 128 active+clean; 27194 kB data, 185 MB used, 15141 MB / 15326 MB avail; 56023 B/s rd, 0 B/s wr, 89 op/s</div></pre></td></tr></table></figure>
<p>有一些问题的状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph pg stat</div><div class="line">v2167: 120 pgs: 120 active+undersized+degraded; 1799 bytes data, 86476 kB used, 10133 MB / 10217 MB avail; 173/519 objects degraded (33.333%)</div></pre></td></tr></table></figure>
<p>或者这样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph pg stat</div><div class="line">v1468117: 5440 pgs: 4 active+clean+scrubbing+deep, 77 active+remapped+backfilling, 5359 active+clean; 33452 GB data, 68799 GB used, 43742 GB / 109 TB avail; 134 kB/s rd, 154 op/s; 6668502/138960328 objects misplaced (4.799%); 40810 kB/s, 81 objects/s recovering</div></pre></td></tr></table></figure>
<h2 id="获取PG列表"><a href="#获取PG列表" class="headerlink" title="获取PG列表"></a>获取PG列表</h2><p>用下列命令获取归置组列表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ceph pg dump</div></pre></td></tr></table></figure>
<p>你也可以让它输出到 JSON 格式，并保存到文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ceph pg dump -o &#123;filename&#125; --format=json</div></pre></td></tr></table></figure>
<p>要查询某个归置组，用下列命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ceph pg &#123;poolnum&#125;.&#123;pg-id&#125; query</div></pre></td></tr></table></figure>
<p>Ceph 会输出成 JSON 格式</p>
<h2 id="写一个object"><a href="#写一个object" class="headerlink" title="写一个object"></a>写一个object</h2><p>1、新建一个文件，内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># cat xinfanyang.txt</div><div class="line">xin fan yang have delicious food</div></pre></td></tr></table></figure>
<p>2、查看数据在pool中默认保存的份数、最小保存份数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># ceph osd pool get rbd size</div><div class="line">size: 3</div><div class="line"># ceph osd pool get rbd min_size</div><div class="line">min_size: 2</div></pre></td></tr></table></figure>
<p>3、写一个文件，在集群中保存对象名为 <code>xfy</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># rados -p rbd put xfy xinfanyang.txt</div></pre></td></tr></table></figure>
<p>4、查看文件保存的位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph osd map rbd xfy</div><div class="line">osdmap e47 pool &apos;rbd&apos; (0) object &apos;xfy&apos; -&gt; pg 0.c76c82f (0.2f) -&gt; up ([1,2,0], p1) acting ([1,2,0], p1)</div></pre></td></tr></table></figure>
<p>文件保存在pg（0.2f）中，pg位于OSD的[1，2，0]中，其中OSD1是主，其他是从。</p>
<p>5、查看内容</p>
<p>在三台机器的三个OSD上，输出内容一致。举例 osd.2，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># ll /var/lib/ceph/osd/ceph-2/current/0.2f*</div><div class="line">/var/lib/ceph/osd/ceph-2/current/0.2f_head:</div><div class="line">总用量 4</div><div class="line">-rw-r--r--. 1 ceph ceph  0 6月  21 15:45 __head_0000002F__0</div><div class="line">-rw-r--r--. 1 ceph ceph 33 7月  27 19:35 xfy__head_0C76C82F__0</div><div class="line"></div><div class="line">/var/lib/ceph/osd/ceph-2/current/0.2f_TEMP:</div><div class="line">总用量 0</div></pre></td></tr></table></figure>
<p>实际对象内容存在 <code>xfy__head_0C76C82F__0</code> 中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># cat /var/lib/ceph/osd/ceph-2/current/0.2f_head/xfy__head_0C76C82F__0</div><div class="line">xin fan yang have delicious food</div></pre></td></tr></table></figure>
<p>osd分布</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"># ceph osd tree</div><div class="line">ID WEIGHT  TYPE NAME       UP/DOWN REWEIGHT PRIMARY-AFFINITY</div><div class="line">-1 0.05457 root default</div><div class="line">-2 0.01819     host ceph-1</div><div class="line"> 0 0.00909         osd.0        up  1.00000          1.00000</div><div class="line"> 3 0.00909         osd.3        up  1.00000          1.00000</div><div class="line">-3 0.01819     host ceph-0</div><div class="line"> 2 0.00909         osd.2        up  1.00000          1.00000</div><div class="line"> 4 0.00909         osd.4        up  1.00000          1.00000</div><div class="line">-4 0.01819     host ceph-2</div><div class="line"> 1 0.00909         osd.1        up  1.00000          1.00000</div><div class="line"> 5 0.00909         osd.5        up  1.00000          1.00000</div></pre></td></tr></table></figure>
<h2 id="PG状态变化"><a href="#PG状态变化" class="headerlink" title="PG状态变化"></a>PG状态变化</h2><p><strong>1、查看 pg[0.2f] 的状态</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph pg dump_stuck |egrep ^0.2f</div><div class="line">ok</div></pre></td></tr></table></figure>
<p><strong>2、挂掉一台机器挂</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># systemctl stop ceph-osd@2</div></pre></td></tr></table></figure>
<p>这时降为两副本了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph osd map rbd xfy</div><div class="line">osdmap e54 pool &apos;rbd&apos; (0) object &apos;xfy&apos; -&gt; pg 0.c76c82f (0.2f) -&gt; up ([1,0], p1) acting ([1,0], p1)</div></pre></td></tr></table></figure>
<p>查看pg状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># ceph pg dump_stuck |egrep ^0.2f</div><div class="line">ok</div><div class="line">0.0	active+undersized+degraded	[1,0]	1	[1,0]	1</div></pre></td></tr></table></figure>
<p>因为之前设置的最小副本数是2，所以没影响，可以正常读取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># rados -p rbd get xfy 111</div><div class="line"># cat 111</div><div class="line">xin fan yang have delicious food</div></pre></td></tr></table></figure>
<p><strong>3、osd out</strong></p>
<p>将 osd.2 out</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph osd out 2</div><div class="line">marked out osd.2.</div></pre></td></tr></table></figure>
<p>如果osd out出集群了，那么 crush 算法就会重新分配一个osd进来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph osd map rbd xfy</div><div class="line">osdmap e103 pool &apos;rbd&apos; (0) object &apos;xfy&apos; -&gt; pg 0.c76c82f (0.2f) -&gt; up ([1,0,4], p1) acting ([1,0,4], p1)</div></pre></td></tr></table></figure>
<p>当然，也可以不out，默认 600s 后自动out，具体时间可调，默认配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph daemon osd.1 config show | grep mon_osd_down_out_interval</div><div class="line">    &quot;mon_osd_down_out_interval&quot;: &quot;600&quot;,</div></pre></td></tr></table></figure>
<p>重新将 osd.2 加入集群</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph osd in 2</div><div class="line">marked in osd.2.</div></pre></td></tr></table></figure>
<p>这时候该对象的分布</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph osd map rbd xfy</div><div class="line">osdmap e117 pool &apos;rbd&apos; (0) object &apos;xfy&apos; -&gt; pg 0.c76c82f (0.2f) -&gt; up ([1,0], p1) acting ([1,0,4], p1)</div></pre></td></tr></table></figure>
<p>可以看到，pg最终的分布是 [1,0]，当前的acting分布是 [1,0,4]</p>
<p><strong>4、挂掉两台机器</strong></p>
<p>down掉主副本所在的 osd.1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># systemctl stop ceph-osd@1</div></pre></td></tr></table></figure>
<p>此时只有一个副本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph osd map rbd xfy</div><div class="line">osdmap e56 pool &apos;rbd&apos; (0) object &apos;xfy&apos; -&gt; pg 0.c76c82f (0.2f) -&gt; up ([0], p0) acting ([0], p0)</div></pre></td></tr></table></figure>
<p>查看pg状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># ceph pg dump_stuck |egrep ^0.2f</div><div class="line">ok</div><div class="line">0.2f    undersized+degraded+peered   [0]          0    [0]              0</div></pre></td></tr></table></figure>
<p>此时再去get这个对象的话，会一直得不到返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># rados -p rbd get xfy 222</div><div class="line">...							// 一直在等待</div></pre></td></tr></table></figure>
<blockquote>
<p>原因：当对象的副本数小于设定的最小数（min_size）时，ceph不响应对应object的IO请求</p>
</blockquote>
<p><strong>5、启动 osd.1</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># systemctl start ceph-osd@1</div></pre></td></tr></table></figure>
<p>此时，会发现，上面卡着的那个命令返回了，并且得到的内容正确。</p>
<p>查看当前pg分布</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph osd map rbd xfy</div><div class="line">osdmap e76 pool &apos;rbd&apos; (0) object &apos;xfy&apos; -&gt; pg 0.c76c82f (0.2f) -&gt; up ([1,4], p1) acting ([1,4], p1)</div></pre></td></tr></table></figure>
<p>pg状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># ceph pg dump_stuck |egrep ^0.2f</div><div class="line">ok</div><div class="line">0.2f    active+undersized+degraded [1,4]          1   [1,4]              1</div></pre></td></tr></table></figure>
<p>注意，这里一个有意思的事情是，在第三步的时候只有一个副本在 osd.0 上，因为 osd.1 是主副本</p>
<p>启动的时候，4 作为临时pg加入，然后等 1 恢复完以后</p>
<p><strong>6、启动 osd.2</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># systemctl start ceph-osd@2</div></pre></td></tr></table></figure>
<p>此时，pg 映射恢复正常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph osd map rbd xfy</div><div class="line">osdmap e83 pool &apos;rbd&apos; (0) object &apos;xfy&apos; -&gt; pg 0.c76c82f (0.2f) -&gt; up ([1,2,0], p1) acting ([1,2,0], p1)</div></pre></td></tr></table></figure>
<p>pg的状态开始变化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># ceph pg dump_stuck |egrep ^0.2f</div><div class="line">ok</div><div class="line">0.2f               active+remapped [1,2]          1 [1,2,4]              1</div></pre></td></tr></table></figure>
<p>直至OK</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph pg dump_stuck |egrep ^0.2f</div><div class="line">ok</div></pre></td></tr></table></figure>
<h2 id="PG修复"><a href="#PG修复" class="headerlink" title="PG修复"></a>PG修复</h2><p><strong>1、我修改一下 osd.1 中对象 xfy 主副本的内容</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># cat /var/lib/ceph/osd/ceph-2/current/0.2f_head/xfy__head_0C76C82F__0</div><div class="line">xin fan yang have delicious food</div><div class="line">// 改为</div><div class="line"># cat /var/lib/ceph/osd/ceph-2/current/0.2f_head/xfy__head_0C76C82F__0</div><div class="line">xin fan yang have food</div></pre></td></tr></table></figure>
<p>2、扫描这个PG</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph pg scrub 0.2f</div><div class="line">instructing pg 0.2f on osd.1 to scrub</div></pre></td></tr></table></figure>
<p><strong>3、读这个对象</strong></p>
<p>这时候会不会发生读到改过的错误内容呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># rados -p rbd get xfy 333</div><div class="line"># cat 333</div><div class="line">xin fan yang have delicious food</div></pre></td></tr></table></figure>
<p>并没有，读到的仍然是正确的内容</p>
<p><strong>4、查看ceph状态</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># ceph -s</div><div class="line">    cluster 4c7ec5af-cbd3-40fd-8c96-0615c77660d4</div><div class="line">     health HEALTH_ERR</div><div class="line">            1 pgs inconsistent</div><div class="line">            1 scrub errors</div><div class="line">  ...</div></pre></td></tr></table></figure>
<p>报的错误是：有一个pg inconsistent，就是内容不一致。那么具体是哪个pg scurb errors了呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># ceph health detail</div><div class="line">HEALTH_ERR 1 pgs inconsistent; 1 scrub errors</div><div class="line">pg 0.2f is active+clean+inconsistent, acting [1,2,0]</div><div class="line">1 scrub errors</div></pre></td></tr></table></figure>
<p>可以看到，正是我们修改的那个pg</p>
<p><strong>5、修复PG</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph pg repair 0.2f</div><div class="line">instructing pg 0.2f on osd.1 to repair</div></pre></td></tr></table></figure>
<p><strong>6、此时内容已被纠正过来</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># cat  /var/lib/ceph/osd/ceph-1/current/0.2f_head/xfy__head_0C76C82F__0</div><div class="line">xin fan yang have delicious food</div></pre></td></tr></table></figure>
<p>此时，集群状态OK</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ceph health detail</div><div class="line">HEALTH_OK</div></pre></td></tr></table></figure>
<h2 id="PG状态列表"><a href="#PG状态列表" class="headerlink" title="PG状态列表"></a>PG状态列表</h2><p><strong>1、peering</strong></p>
<p>Ceph 为归置组建立互联时，会让存储归置组副本的 OSD 之间就其中的对象和元数据状态达成一致。 Ceph 完成了互联，也就意味着存储着归置组的 OSD 就其当前状态达成了一致。然而，互联过程的完成并不能表明各副本都有了数据的最新版本。</p>
<p><strong>2、active</strong></p>
<p>peering完成后，一归置组状态会变为 active 。 active 状态意味着数据已完好地保存到了主归置组和副本归置组。</p>
<p><strong>3、clean</strong></p>
<p>某一归置组处于 clean 状态时，主 OSD 和副本 OSD 已成功互联，并且没有偏离的归置组。 Ceph 已把归置组中的对象复制了规定次数。</p>
<p><strong>4、degraded</strong></p>
<p>当客户端向主 OSD 写入数据时，由主 OSD 负责把数据副本写入其余副本 OSD 。主 OSD 把对象写入存储器后，在副本 OSD 创建完对象副本并报告给主 OSD 之前，主 OSD 会一直停留在 degraded 状态。</p>
<ul>
<li>归置组状态可以处于 active+degraded 状态，原因在于一 OSD 即使尚未持有所有对象也可以处于 active 状态。如果一 OSD 挂了， Ceph 会把分配到此 OSD 的归置组都标记为 degraded ；那个 OSD 重生后，它们必须重新互联。然而，客户端仍可以向处于 degraded 状态的归置组写入新对象，只要它还在 active 状态。</li>
<li>如果一 OSD 挂了，且老是处于 degraded 状态， Ceph 会把 down 的 OSD 标记为在集群外（ out ）、并把那个 down 掉的 OSD 上的数据重映射到其它 OSD 。从标记为 down 到 out 的时间间隔由 mon osd down out interval 控制，默认是 300 秒。</li>
<li>归置组也会被降级（ degraded ），因为 Ceph 找不到本应存在于此归置组中的一或多个对象，这时，你不能读写找不到的对象，但仍能访问位于降级归置组中的其它对象。</li>
</ul>
<p><strong>5、recovering</strong></p>
<p>Ceph 被设计为可容错，可抵御一定规模的软、硬件问题。当某 OSD 挂了（ down ）时，其内的归置组会落后于别的归置组副本；此 OSD 重生（ up ）时，归置组内容必须更新到当前状态；在此期间， OSD 处于 recovering 状态。</p>
<blockquote>
<p>恢复并非总是这些小事，因为一次硬件失败可能牵连多个 OSD 。比如一个机柜或房间的网络交换机失败了，这会导致多个主机上的 OSD 落后于集群的当前状态，故障恢复后每一个 OSD 都必须恢复。</p>
</blockquote>
<p>Ceph 提供了几个选项来均衡资源竞争，如新服务请求、恢复数据对象和恢复归置组到当前状态。</p>
<ul>
<li><code>osd recovery delay start</code> 选项允许一 OSD 在开始恢复进程前，先重启、重建互联、甚至处理一些重放请求；</li>
<li><code>osd recovery threads</code> 选项限制恢复进程的线程数，默认为 1 线程； </li>
<li><code>osd recovery thread timeout</code> 设置线程超时，因为多个 OSD 可能交替失败、重启和重建互联； </li>
<li><code>osd recovery max active</code> 选项限制一 OSD 最多同时接受多少请求，以防它压力过大而不能正常服务； </li>
<li><code>osd recovery max chunk</code> 选项限制恢复数据块尺寸，以防网络拥塞。</li>
</ul>
<p><strong>6、backfilling</strong></p>
<p>有新 OSD 加入集群时， CRUSH 会把现有集群内的部分归置组重分配给它。强制新 OSD 立即接受重分配的归置组会使之过载，用归置组回填可使这个过程在后台开始。只要回填顺利完成，新 OSD 就可以对外服务了。</p>
<p>在回填运转期间，你可能见到以下几种状态之一： </p>
<ul>
<li>backfill_wait 表明一回填操作在等待时机，尚未开始； </li>
<li>backfill 表明一回填操作正在进行； </li>
<li>backfill_too_full 表明需要进行回填，但是因存储空间不足而不能完成。</li>
<li>incomplete 状态表明某归置组不能回填</li>
</ul>
<p>Ceph 提供了多个选项来解决重分配归置组给一 OSD （特别是新 OSD ）时相关的负载问题。</p>
<ul>
<li>默认，<code>osd_max_backfills</code> 把双向的回填并发量都设置为 10 ； </li>
<li><code>osd backfill full \ ratio</code> 可让一 OSD 在接近占满率（默认 85% ）时拒绝回填请求，如果一 OSD 拒绝了回填请求，在 <code>osd backfill retry interval</code> 间隔之后将重试（默认 10 秒）； </li>
<li>OSD 也能用 <code>osd backfill scan min</code> 和 <code>osd backfill scan max</code> 来管理扫描间隔（默认 64 和 512 ）。</li>
</ul>
<p><strong>7、remapped</strong></p>
<p>负责维护某一归置组的 Acting Set 变更时，数据要从旧集合迁移到新的。新的主 OSD 要花费一些时间才能提供服务，所以老的主 OSD 还要持续提供服务、直到归置组迁移完。数据迁移完后，运行图会包含新 acting set 里的主 OSD 。</p>
<p><strong>8、stale</strong></p>
<p>虽然 Ceph 用心跳来保证主机和守护进程在运行，但是 ceph-osd 仍有可能进入 stuck 状态，它们没有按时报告其状态（如网络瞬断）。默认， OSD 守护进程每半秒（ 0.5 ）会一次报告其归置组、出流量、引导和失败统计状态，此频率高于心跳阀值。如果一归置组的主 OSD 所在的 acting set 没能向监视器报告、或者其它监视器已经报告了那个主 OSD 已 down ，监视器们就会把此归置组标记为 stale 。</p>
<blockquote>
<p>启动集群时，会经常看到 stale 状态，直到互联完成。集群运行一阵后，如果还能看到有归置组位于 stale 状态，就说明那些归置组的主 OSD 挂了（ down ）、或没在向监视器报告统计信息。</p>
</blockquote>
<p><strong>9、undersized</strong></p>
<p>PG的副本数比pool的配置中副本数少。</p>
<p>可以通过如下命令查看指定pool的副本数，默认是3。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># ceph osd pool get &#123;poolname&#125; size</div></pre></td></tr></table></figure>
<p><strong>10、peered</strong></p>
<p>PG已经peered，但是副本数少于pool配置中指定的最小副本数，不能向client提供IO操作。在这种状态下会出发 recovery 操作，所以 pg 最终会愈合到最小副本数。</p>
<p>可通过如下命令得到指定pool的最小副本数，默认是2。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># ceph osd pool get &#123;poolname&#125; min_size</div></pre></td></tr></table></figure>
<p><strong>11、incomplete</strong></p>
<p>ceph检测到一个PG缺少可能已经发生的写入信息，或没有任何健康的副本。如果看到此状态，请尝试启动任何可能包含所需信息的失败的OSD，或暂时调整min_size以允许恢复。</p>
<p><strong>其他：</strong></p>
<p>一个归置组状态不是 active+clean 时未必有问题。一般来说，归置组卡住时 Ceph 的自修复功能往往无能为力，卡住的状态细分为：</p>
<ul>
<li>Unclean: 归置组里有些对象的副本数未达到期望次数，它们应该在恢复中；</li>
<li>Inactive: 归置组不能处理读写请求，因为它们在等着一个持有最新数据的 OSD 回到 up 状态；</li>
<li>Stale: 归置组们处于一种未知状态，因为存储它们的 OSD 有一阵子没向监视器报告了（由 mon osd report timeout 配置）。</li>
</ul>
<p>找出卡住的归置组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ceph pg dump_stuck [unclean|inactive|stale|undersized|degraded]</div></pre></td></tr></table></figure>

      
       <hr><span style="font-style: italic;color: gray;"> 本博客为个人学习总结随笔，所有文章非特殊标注皆为原创，转载请务必注明出处！欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。 </span>
    </div>
</article>


<p>
    <a href="javascript:void(0)" class="dashang" onclick="dashangToggle()">赏</a>
</p>


<div class="article_copyright">
    <p><span>文章标题:</span>ceph placement group</p>
    <p><span>文章字数:</span><span class="post-count">3,569</span></p>
    <p><span>本文作者:</span><a href="javascript:void(0)" title="夏天的风">夏天的风</a></p>
    <p><span>发布时间:</span>2017-07-28, 15:20:25</p>
    <p><span>最后更新:</span>2017-07-28, 15:47:52</p>
    <span>原始链接:</span><a class="post-url" href="/2017/07/28/ceph-placement-group/" title="ceph placement group">http://xiaqunfeng.cc/2017/07/28/ceph-placement-group/</a>
    <p>
        <span>版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>


    <div id="comments"></div>
<link rel="stylesheet" href="/css/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: 'null',
            clientSecret: 'null',
            repo: 'yelog.github.io',
            owner: 'yelog',
            admin: ['yelog'],
            id: location.pathname,
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>



    

    </div>
    <div class="copyright">
        <p class="footer-entry">©2018 xiaqunfeng</p>
<p class="footer-entry">Buit with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" href="javascript:void(0)"></a>
    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>

</body>
<script src="//cdn.bootcss.com/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>

<script src="//cdn.bootcss.com/photoswipe/4.1.2/photoswipe.min.js"></script>
<script src="//cdn.bootcss.com/photoswipe/4.1.2/photoswipe-ui-default.min.js"></script>

<script src="/js/script.js"></script>
<script>
    var img_resize = 'photoSwipe';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#ceph','#storage','#paper','#deeplearning','#Linux','#shell','#machine learning','#rocksdb','#centos','#ubuntu','#code','#git','#mac','#caffe','#python','#ganesha','#cloud','#network',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        

        // PhotoSwipe
        $('article').each(function(i){
            $(this).find('img').each(function(){
                if ($(this).closest('figure').hasClass('article-gallery-img')) {
                    return;
                }
                var alt = this.alt;
                $(this)
                    .wrap('<figure class="article-gallery-img" itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"></figure>')
                    .wrap('<a href="' + this.src + '" title="' + alt + '"></a>');
                $(this).after('<div class="img_alt"><span>' + (alt || '') + '</span></div>');
            });
        });

        var pswpElement = document.querySelectorAll('.pswp')[0];
        if (pswpElement) {
            var gallerySelector = '.article-gallery, article';

            var initPhotoSwipeFromDOM = function(gallerySelector) {

                // parse slide data (url, title, size ...) from DOM elements
                // (children of gallerySelector)
                var parseThumbnailElements = function(el) {
                    var thumbElements = $(el).find('figure.article-gallery-img').toArray(),
                        numNodes = thumbElements.length,
                        items = [],
                        figureEl,
                        linkEl,
                        size,
                        imgEl,
                        item;

                    for (var i = 0; i < numNodes; i++) {

                        figureEl = thumbElements[i]; // <figure> element

                        // include only element nodes
                        if (figureEl.nodeType !== 1) {
                            continue;
                        }

                        linkEl = figureEl.children[0]; // <a> element
                        imgEl = linkEl.children[0]; // <img>

                        size = linkEl.getAttribute('data-size');
                        size = size && size.split('x');

                        // create slide object
                        item = {
                            src: linkEl.getAttribute('href'),
                            w: size && parseInt(size[0], 10) || imgEl.width,
                            h: size && parseInt(size[1], 10) || imgEl.height
                        };

                        if (figureEl.children.length > 1) {
                            // <figcaption> content
                            item.title = figureEl.children[1].innerHTML;
                        }

                        if (linkEl.children.length > 0) {
                            // <img> thumbnail element, retrieving thumbnail url
                            item.msrc = linkEl.children[0].getAttribute('src');
                        }

                        item.el = figureEl; // save link to element for getThumbBoundsFn
                        items.push(item);
                    }

                    return items;
                };

                // find nearest parent element
                var closest = function closest(el, fn) {
                    return el && (fn(el) ? el : closest(el.parentNode, fn));
                };

                // triggers when user clicks on thumbnail
                var onThumbnailsClick = function(e) {
                    e = e || window.event;

                    var eTarget = e.target || e.srcElement;

                    // find root element of slide
                    var clickedListItem = closest(eTarget, function(el) {
                        return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
                    });

                    if (!clickedListItem) {
                        return;
                    }

                    if (e.preventDefault) {
                        e.preventDefault();
                    } else {
                        e.returnValue = false;
                    }

                    // find index of clicked item by looping through all child nodes
                    // alternatively, you may define index via data- attribute
                    var clickedGallery = $(clickedListItem).closest(gallerySelector)[0],
                        childNodes = $(clickedGallery).find('figure.article-gallery-img').toArray(),
                        numChildNodes = childNodes.length,
                        nodeIndex = 0,
                        index;

                    for (var i = 0; i < numChildNodes; i++) {
                        if (childNodes[i].nodeType !== 1) {
                            continue;
                        }

                        if (childNodes[i] === clickedListItem) {
                            index = nodeIndex;
                            break;
                        }
                        nodeIndex++;
                    }



                    if (index >= 0) {
                        // open PhotoSwipe if valid index found
                        openPhotoSwipe(index, clickedGallery);
                    }
                    return false;
                };

                // parse picture index and gallery index from URL (#&pid=1&gid=2)
                var photoswipeParseHash = function() {
                    var hash = window.location.hash.substring(1),
                        params = {};

                    if (hash.length < 5) {
                        return params;
                    }

                    var vars = hash.split('&');
                    for (var i = 0; i < vars.length; i++) {
                        if (!vars[i]) {
                            continue;
                        }
                        var pair = vars[i].split('=');
                        if (pair.length < 2) {
                            continue;
                        }
                        params[pair[0]] = pair[1];
                    }

                    if (params.gid) {
                        params.gid = parseInt(params.gid, 10);
                    }

                    return params;
                };

                var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
                    var pswpElement = document.querySelectorAll('.pswp')[0],
                        gallery,
                        options,
                        items;

                    items = parseThumbnailElements(galleryElement);

                    // define options (if needed)
                    options = {

                        // define gallery index (for URL)
                        galleryUID: galleryElement.getAttribute('data-pswp-uid'),

                        getThumbBoundsFn: function(index) {
                            // See Options -> getThumbBoundsFn section of documentation for more info
                            var thumbnail = items[index].el.getElementsByTagName('img')[0], // find thumbnail
                                pageYScroll = window.pageYOffset || document.documentElement.scrollTop,
                                rect = thumbnail.getBoundingClientRect();

                            return {
                                x: rect.left,
                                y: rect.top + pageYScroll,
                                w: rect.width
                            };
                        }
                    };

                    // PhotoSwipe opened from URL
                    if (fromURL) {
                        if (options.galleryPIDs) {
                            // parse real index when custom PIDs are used
                            // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                            for (var j = 0; j < items.length; j++) {
                                if (items[j].pid == index) {
                                    options.index = j;
                                    break;
                                }
                            }
                        } else {
                            // in URL indexes start from 1
                            options.index = parseInt(index, 10) - 1;
                        }
                    } else {
                        options.index = parseInt(index, 10);
                    }

                    // exit if index not found
                    if (isNaN(options.index)) {
                        return;
                    }

                    if (disableAnimation) {
                        options.showAnimationDuration = 0;
                    }

                    // Pass data to PhotoSwipe and initialize it
                    gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);

                    gallery.listen('imageLoadComplete', function(index, item) {
                        var linkEl = item.el.children[0];
                        var img = item.container.children[0];
                        if (!linkEl.getAttribute('data-size')) {
                            linkEl.setAttribute('data-size', img.naturalWidth + 'x' + img.naturalHeight);
                            item.w = img.naturalWidth;
                            item.h = img.naturalHeight;
                            gallery.invalidateCurrItems();
                            gallery.updateSize(true);
                        }
                    });

                    gallery.init();
                };

                // loop through all gallery elements and bind events
                var galleryElements = document.querySelectorAll(gallerySelector);

                for (var i = 0, l = galleryElements.length; i < l; i++) {
                    galleryElements[i].setAttribute('data-pswp-uid', i + 1);
                    galleryElements[i].onclick = onThumbnailsClick;
                }

                // Parse URL and open gallery if it contains #&pid=3&gid=1
                var hashData = photoswipeParseHash();
                if (hashData.pid && hashData.gid) {
                    openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
                }
            };

            // execute above function
            initPhotoSwipeFromDOM(gallerySelector);
        }
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 2px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /*引用块样式*/
    
    .post .pjax article blockquote {
        padding: 10px 20px;
        background-color: white;
        border: none;
        border-left: 4px solid #42b983;
        border-right: 4px solid #42b983;
        border-radius: 10px;
    }
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.1;
        background: url("http://oow6unnib.bkt.clouddn.com/0844C6E9-3F8D-423A-9ABF-3061674AD63E-8278-00000666B57CB13E_tmp.PNG");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    
</style>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element, as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. PhotoSwipe keeps only 3 slides in DOM to save memory. -->
        <!-- don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>





</html>
